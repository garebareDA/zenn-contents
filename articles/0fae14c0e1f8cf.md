---
title: "Unityã§ãƒ‰ãƒƒãƒˆçµµã®Vtuberã‚’ä½œã£ãŸã®ã§ç´¹ä»‹"
emoji: "ğŸ¶"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["unity", "csharp"]
published: true
---

Vtuberã«ãªã‚ŠãŸãã¦ãŠã‚‚ã¡ã‚ƒçš„ãªã®ã‚’ä½œã£ã¦ã¿ãŸã®ã§è¨˜äº‹ã«ã—ã¦ã¿ã¾ã™ã€‚
# å®Œæˆå“
![](/images/PixelVtuber/pixelVtuber.gif)
LipSyncã§å£ãŒå‹•ãã€ãƒã‚¦ã‚¹ã¨ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã§ä¸¡è…•ãŒå‹•ãã¾ã™ã€‚
ã‚²ãƒ¼ãƒ ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãªã©ã«ã‚‚å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚
ã‚«ãƒ¡ãƒ©ã‚„ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ¼ã®æ©Ÿå™¨ã¯å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚

# ãªãœãƒ‰ãƒƒãƒˆçµµã«ãªã£ãŸã®ã‹
ä¸€ç•ªã¯ã˜ã‚ã¯3Dãƒ¢ãƒ‡ãƒ«ã§Vtuberã‚’ä½œã£ãŸã®ã§ã™ãŒãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ¼ã§ãã‚‹æ©Ÿå™¨ã‚’å½“æ™‚é«˜æ ¡ç”Ÿã ã£ãŸã®ã§è²·ã†ã“ã¨ãŒã§ããšã€LipSyncã§å£ã‚’å‹•ã‹ã—å¾Œä»˜ã‘ã§ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¦ã„ã¾ã—ãŸã€‚
ã„ã¡ã„ã¡ãã‚“ãªã“ã¨ã‚’ã—ã¦ã„ã‚‹ã¨æµçŸ³ã«é¢å€’ãªã®ã§ãƒã‚¦ã‚¹ã¨ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã«é€£å‹•ã•ã›ã‚ˆã†ã¨ã—ãŸã®ã§ã™ãŒUnityã§IKã‚’å®Ÿè£…ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãã‚Œã‚‹ã‚¢ã‚»ãƒƒãƒˆãŒé«˜ã‹ã£ãŸã®ã§æ–­å¿µã€‚
ã ã£ãŸã‚‰ã‚‚ã†2Dã§ã„ã„ã‚„ã£ã¦ãªã£ãŸã®ã§ã™ãŒWebã‚«ãƒ¡ãƒ©ã‚’æŒã£ã¦ãªã‹ã£ãŸã®ã§Live2Dãªã©ã‚’å‹•ã‹ã™ã“ã¨ãŒã§ããšã«è©°ã‚“ã§ã¾ã—ãŸã€‚
ã˜ã‚ƒã‚ã‚‚ã†LipSyncã¨ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã¨ãƒã‚¦ã‚¹ã®å‹•ãã®ã¿ã§Vtuberã®å‹•ãã‚’ä½œã£ã¡ã‚ƒãˆã¨ãªã‚Šã¾ã—ãŸã€‚ãŠé‡‘ã‚‚ã‹ã‹ã‚‰ãªã„ã—ã€‚
ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã¨ãƒã‚¦ã‚¹ã«Vtuberã®å‹•ãã‚’é€£å‹•ã•ã›ã‚‹ã¨ãªã‚‹ã¨æ™®é€šã®çµµã ã¨ã‚³ã‚¹ãƒˆãŒã‹ã‹ã‚‹ã®ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®æšæ•°ãŒå°‘ãªãã¦ã‚‚é•å’Œæ„Ÿã®ãªã„ãƒ‰ãƒƒãƒˆçµµã«ãªã‚Šã¾ã—ãŸã€‚

# ä½¿ã£ã¦ã„ã‚‹ã‚¢ã‚»ãƒƒãƒˆ
https://developer.oculus.com/downloads/package/oculus-lipsync-unity/
https://github.com/Elringus/UnityRawInput
https://github.com/kaikikazu/XinputGamePad
https://assetstore.unity.com/packages/tools/integration/unirx-reactive-extensions-for-unity-17276
åŸºæœ¬çš„ã«ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å…¥åŠ›ã‚’å—ã‘å–ã‚‹ã‚‚ã®ã¨LipSyncã«é–¢ã—ã¦ã¯ã‚¢ã‚»ãƒƒãƒˆã«é ¼ã‚Šã¾ã—ãŸã€‚

# ç´ æã‚’ç”¨æ„ã™ã‚‹
æœ€åˆã«äººå‹ã®ãƒ‰ãƒƒãƒˆçµµã®ã©ã®éƒ¨åˆ†ã‚’ã©ã®ãƒ‡ãƒã‚¤ã‚¹ã§å‹•ã‹ã™ã‚’æ±ºã‚ã¦ãƒ‰ãƒƒãƒˆçµµã‹ã‚‰å·®åˆ†ã‚‚å«ã‚ã¦ä½œæˆã—ã¾ã—ãŸã€‚

## ãƒ‰ãƒƒãƒˆçµµã®å…¨ä½“åƒ
![](/images/PixelVtuber/all.png)

### å£
å£ã¯ãƒã‚¤ã‚¯ã‚’ä½¿ã„ã€LipSyncã§å‹•ã‹ã™ã®ã§ã€ã‚ã€ã„ã€ã†ã€ãˆã€ãŠã®å£ã®å·®åˆ†ã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚
![](/images/PixelVtuber/mouth.png)
![](/images/PixelVtuber/mouth.gif)

### å³è…•
å³è…•ã¯ãƒã‚¦ã‚¹ã§å‹•ã‹ã™ã®ã§å³ã€å·¦ã€å¥¥ã€æ‰‹å‰ã®å·®åˆ†ã‚’ä½œã‚Šã¾ã—ãŸã€‚
å³è…•ãŒæœã«ã‹ã¶ã£ãŸã‚Šã€æœã®å½±ãŒå¤‰ã‚ã£ãŸã‚Šã™ã‚‹ãŸã‚ã€æœã‚‚ä¸€ç·’ã«æ›¸ãè¾¼ã‚“ã§ã„ã¾ã™ã€‚
ãã—ã¦å‹•ãã‚’æ»‘ã‚‰ã‹ã«ã™ã‚‹ãŸã‚ã«ä¸­é–“ã«ä¸€ã‚³ãƒã‚’ãã‚Œãã‚ŒæŒŸã‚“ã§ã„ã¾ã™(ä¸€éƒ¨å…¼ç”¨)ã€‚
![](/images/PixelVtuber/right.png)
![](/images/PixelVtuber/right.gif)

### å·¦è…•
å·¦è…•ã¯ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’æŠ¼ã—ã¦ã„ã‚‹æ™‚ã ã‘ä¸‹ã«å‹•ãã¾ã™ã€‚
![](/images/PixelVtuber/left.png)
![](/images/PixelVtuber/left.gif)

### ç›®
ç›®ã¯è¦–ç·šã®ç§»å‹•ã‚’ãƒã‚¦ã‚¹ã¨é€£å‹•ã•ã›ãŸã„ã®ã§ä¸Šä¸‹å·¦å³ã«è¦–ç·šã‚’é€ã£ã¦ã„ã‚‹å·®åˆ†ã‚’ãã‚Œãã‚Œç”¨æ„ã—ã€ç¬ãã‚’ãƒ©ãƒ³ãƒ€ãƒ ã§ã•ã›ãŸã„ã®ã§ç¬ãã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚ä½œæˆã—ã¦ã„ã¾ã™ã€‚
![](/images/PixelVtuber/eye.png)
![](/images/PixelVtuber/eye.gif)

### è¡¨æƒ…
è¡¨æƒ…ã¯åˆ‡ã‚Šæ›¿ãˆã‚‹æ–¹å¼ã‚’å–ã‚Šã¾ã—ãŸã€‚
Ctrlã‚­ãƒ¼ã¨æ•°å­—ã‚­ãƒ¼ã§åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚
å·¦Ctrlã‚­ãƒ¼ã¨æ•°å­—ã‚­ãƒ¼ã§ç›®ã®åˆ‡ã‚Šæ›¿ãˆã€å³Ctrlã‚­ãƒ¼ã¨æ•°å­—ã§æ€’ã‚Šãƒãƒ¼ã‚¯ãªã©ã®è£…é£¾å“ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ã«ã¾ã—ãŸã€‚
![](/images/PixelVtuber/expression.png)
![](/images/PixelVtuber/expression.gif)

ã¾ã¨ã‚ã‚‹ã¨
ãƒã‚¦ã‚¹ -> å³è…•ã¨ç›®ç·š
ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ -> å·¦è…•
å£ -> ãƒã‚¤ã‚¯
ç¬ã -> ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ãƒ©ãƒ³ãƒ€ãƒ 
è¡¨æƒ… -> Ctrl + Num
ã¨ã„ã†æ„Ÿã˜ã§ãã‚Œãã‚Œå¯¾å¿œã„ã¾ã™ã€‚
ã™ã¹ã¦å®Œæˆã—ãŸã‚‰Unityã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦è¨­ç½®ã—ã¦OVR LipSyncã®è¨­å®šã‚’æ¸ˆã¾ã—ã¾ã™ã€‚
ãã—ãŸã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ãŸã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¾ã™ã€‚

# ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§å‹•ã‹ã™
ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä¸­èº«ã‚‚å°‘ã—ç´¹ä»‹ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚
## å³è…•ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
```csharp
enum Dress
{
    up,
    down,
    left,
    right,
    init,
}

float mouse_x_before = 0;
float mouse_y_before = 0;

void Update()
{
    float x = Input.mousePosition.x;
    float y = Input.mousePosition.y;

    float mouse_x_delta = mouse_x_before - x;
    float mouse_y_delta = mouse_y_before - y;

    mouse_x_before = x;
    mouse_y_before = y;

    if (mouse_x_delta < -mouseSize && Dress.right != dress)
    {
        dress = Dress.left;
        dressAnimator.Play("left");
    }

    if (mouse_x_delta > mouseSize && Dress.left != dress)
    {
        dress = Dress.right;
        dressAnimator.Play("right");
    }
    if (mouse_y_delta < -mouseSize && Dress.up != dress)
    {
        dress = Dress.up;
        dressAnimator.Play("up");
    }
    if (mouse_y_delta > mouseSize && Dress.down != dress)
    {
        dress = Dress.down;
        dressAnimator.Play("down");
    }
}
```
ã‚³ãƒ¼ãƒ‰ã¯ã“ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚
å³è…•ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¯ãƒã‚¦ã‚¹ã‚’ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã‚‚å—ã‘å–ã‚ŠãŸã„ã®ã§`Input.mousePosition`ã‚’ä½¿ã„ã¾ã™ã€‚
ãƒã‚¦ã‚¹ã®å‹•ãã®å·®åˆ†ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå†ç”Ÿã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

## ç¬ãã¨ç›®ã®è¦–ç·š

```csharp
void Update()
{
    float random = Random.Range(0, 500);
    eyeAnimator.SetBool("blink", random < 5);
}
```
ç¬ãã¯ãƒ©ãƒ³ãƒ€ãƒ ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†ç”Ÿã—ã¾ã™ã€‚

```diff csharp
void Update()
{
    float x = Input.mousePosition.x;
    float y = Input.mousePosition.y;

    float mouse_x_delta = mouse_x_before - x;
    float mouse_y_delta = mouse_y_before - y;

    mouse_x_before = x;
    mouse_y_before = y;

+   float eyerandom = Random.Range(0, 500);
+   bool eyeMove = false;
+   eyeMove = eyerandom < 2;

    if (mouse_x_delta < -mouseSize && Dress.right != dress)
    {
        dress = Dress.left;
        dressAnimator.Play("left");
+       eyeAnimator.SetBool("left", eyeMove);
    }

    if (mouse_x_delta > mouseSize && Dress.left != dress)
    {
        dress = Dress.right;
        dressAnimator.Play("right");
+       eyeAnimator.SetBool("right", eyeMove);
    }
    if (mouse_y_delta < -mouseSize && Dress.up != dress)
    {
        dress = Dress.up;
        dressAnimator.Play("up");
+       eyeAnimator.SetBool("up", eyeMove);
    }
    if (mouse_y_delta > mouseSize && Dress.down != dress)
    {
        dress = Dress.down;
        dressAnimator.Play("down");
+       eyeAnimator.SetBool("left", eyeMove);
    }
}
```
ç›®ç·šã¯ãƒã‚¦ã‚¹ã®å‹•ãã«é€£å‹•ã•ã›ã‚‹ã®ã§å…ˆç¨‹ã®å³è…•ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«è¿½åŠ ã—ã¾ã™ã€‚
ã“ã‚Œã§`eyerandom`ãŒ2ä»¥ä¸‹ã¨ãã«è¦–ç·šãŒç§»å‹•ã™ã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå†ç”Ÿã•ã‚Œã¾ã™ã€‚

## å·¦è…•ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
```csharp

using UnityRawInput;
using UniRx;

private void OnEnable()
 {
    RawKeyInput.Start(true);
    RawKeyInput.OnKeyUp += OnKeyUp;
    RawKeyInput.OnKeyDown += OnKeyDown;
 }

private void OnDisable()
{
    RawKeyInput.Stop();
    RawKeyInput.OnKeyUp -= OnKeyUp;
    RawKeyInput.OnKeyDown -= OnKeyDown;
}

private void OnKeyUp(RawKey key)
{
    armAnimator.Play("idle");
    push = false;
}

private void OnKeyDown(RawKey key)
{
    armAnimator.Play("push");
}
```
ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®å…¥åŠ›ã¯ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã‚‚å—ã‘å–ã‚ŠãŸã„ã®ã§UnityRawInputã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚
ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãŒæŠ¼ã•ã‚ŒãŸã¨ãã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå†ç”Ÿã•ã‚Œã¾ã™ã€‚
ã“ã‚Œã‚‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ã¦XinputGamePadã§ã‚²ãƒ¼ãƒ ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãªã©ã«ã‚‚å¯¾å¿œã•ã›ã¾ã—ãŸã€‚

 # çµ‚ã‚ã‚Šã«
è¡¨æƒ…ã®å¤‰åŒ–ã¯èª²é¡Œã§ã™ãŒãƒ‰ãƒƒãƒˆçµµã§è¦‹æ „ãˆã™ã‚‹ç¨‹åº¦ã‚‚ã®ã¯ä½œã‚ŒãŸã¨æ€ã„ã¾ã™ã€‚
ã‚ã¨ä½•ã‚ˆã‚Šå®‰ã„ã—ã‚³ã‚¹ãƒ‘ã‚‚ã„ã„ã€Vtuberã®ãŸã‚ã«è¿½åŠ è³¼å…¥ã—ãŸã‚‚ã®ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
ã„ãã¤ã‹å‹äººã®ãŸã‚ã«ä½œã£ãŸã®ã§ã™ãŒãƒ‡ã‚¶ã‚¤ãƒ³ãŒãŠã¾ã‹ã›ã§ã‚ã‚Œã°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è‡ªä½“ã¯æµç”¨ã§ãã‚‹ã®ã§ä¸€æ—¥ä¸€ã¤ã®ãƒšãƒ¼ã‚¹ã§ä½œã‚Œã¾ã—ãŸã€‚