---
title: "å®šæ•°ã‚’Yamlã§ç®¡ç†ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã‚’ä½œã‚Šã¾ã—ãŸ"
emoji: "ğŸ¦˜"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [yaml, cli]
published: true
publication_name: "smartcamp"
---

## ã¯ã˜ã‚ã«

CLIã‚’ãƒ„ãƒ¼ãƒ«ã‚’ä½œã£ãŸã®ã§æ„Ÿã˜ã¦ã„ãŸèª²é¡Œã‚’å…±æœ‰ã—ã¤ã¤è¨˜äº‹ã‚’æ›¸ã„ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã—ãŸã€‚
ã“ã¡ã‚‰æˆæœç‰©ã®ãƒªãƒ³ã‚¯ã«ãªã‚Šã¾ã™ã€‚
<https://www.npmjs.com/package/@garebare/shared-constants>

### ã©ã†ã„ã†ãƒ„ãƒ¼ãƒ«ã‹

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®è¨€èªãŒåˆ¥ã ãŒå…±é€šã®å®šæ•°ã‚’æŒã£ã¦ãŠããŸã„å ´åˆã«ä½¿ã†ãƒ„ãƒ¼ãƒ«ã«ãªã‚Šã¾ã™ã€‚
ä¸‹è¨˜ã®ã‚ˆã†ãªYamlã‹ã‚‰è¤‡æ•°ã®è¨€èªå‘ã‘ã«å®šæ•°ãŒå®šç¾©ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡ºåŠ›ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```yaml
format: shared-constants //ä»–ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒå®Ÿè¡Œã•ã‚Œã‚‹ã®ã‚’é˜²ããŸã‚
constants:
  values:
    - key: api_url // å®šæ•°å
      value: "https://api.example.com" // å®šæ•°ã®ä¸­èº«
      type: "string" //å‹å
    - key: max_retries
      value: 3
      type: "number|int" //è¤‡æ•°è¨€èªã«å‡ºåŠ›ã™ã‚‹å ´åˆã¯è¤‡æ•°ã®å‹ã‚’è¨­å®šå¯èƒ½ã€å…ˆé ­ã®ã‚‚ã®ã‹ã‚‰å„ªå…ˆã•ã‚Œã‚‹
    - key: debug_mode
      value: true
      type: "boolean"
target:
  - language: typescript
    output: "./output/"
    nameSpace: "config"
  - language: go
    output: "./output/"
    nameSpace: "config"
  - language: python
    output: "./output/"
    nameSpace: "config"
  - language: ruby
    output: "./output/"
    nameSpace: "config"
    comment: ""
```

Yamlã‹ã‚‰Goã¸ã®å¤‰æ›ä¾‹

```go
package config
const (
  ApiUrl string = "https://api.example.com"
  MaxRetries int = 3
  DebugMode bool = true
)
```

Yamlã‚’TypeScriptã¸ã®å¤‰æ›ä¾‹

```typescript
export const config = {
  API_URL: 'https://api.example.com' as string,
  MAX_RETRIES: 3 as number,
  DEBUG_MODE: true as boolean,
} as const;
```

Yamlã‚’Rubyã¸ã®å¤‰æ›ä¾‹

``` ruby
module config
  API_URL = 'https://api.example.com'
  MAX_RETRIES = 3
  DEBUG_MODE = true
end
```

Yamlã‚’Pythonã¸ã®å¤‰æ›ä¾‹

``` python
API_URL = "https://api.example.com"
MAX_RETRIES = 3
DEBUG_MODE = True
__all__ = ["API_URL", "MAX_RETRIES", "DEBUG_MODE"]
```

## ãªãœã‚ã–ã‚ã–Yamlã‹ã‚‰å¤‰æ›ã™ã‚‹ã®ã‹

å…±é€šã®å€¤ã‚’ä½¿ã„ãŸã„ã®ã§ã‚ã‚Œã°ã€åŒä¸€ã®Yamlã‚’ãã‚Œãã‚Œã®ç’°å¢ƒã§ãƒ‘ãƒ¼ã‚¹ã—ä¸­èº«ã‚’å–ã‚Šå‡ºã›ã°ç›®çš„ã‚’é”æˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒã“ã®ãƒ„ãƒ¼ãƒ«ã¯ã‚ã–ã‚ã–å¤‰æ›æŒŸã‚“ã§ã„ã¾ã™ã€‚
ä½•æ•…ã‹ã¨ã„ã†ã¨ã‚¨ãƒ‡ã‚£ã‚¿ã®ä¿ç®¡ã‚’åŠ¹ã‹ã›ã‚‹ã®ã¨ã€ãƒ‘ãƒ¼ã‚¹ã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å‹ã‚’å®šç¾©ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ¸›ã‚‰ã™ãŸã‚ã§ã™ã€‚

## ä¸»ãªæ©Ÿèƒ½

- å®šæ•°ã‚’Yamlã§ç®¡ç†
  - è¤‡æ•°ã®å®šæ•°ã‚’Yamlã§ä¸€å…ƒç®¡ç†ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
- TypeScript, Go, Python, Rubyã¸ã®å¤‰æ›
  - 4ã¤ã®è¨€èªã«å¯¾å¿œã—ã¦ãŠã‚Šã€å‡ºåŠ›å…ˆã‚‚è‡ªç”±ã§ã™ã€‚
- Yamlå†…ã§ã®å‹å®šç¾©
  - Yamlå†…ã§è¤‡æ•°è¨€èªã«å¯¾å¿œã—ã¦å‹ã‚’å®šç¾©ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
- åå‰ç©ºé–“ã®å®šç¾©
  - è¨€èªã”ã¨ã«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åã‚„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™

## å¤‰æ›å‡¦ç†ã«ã¤ã„ã¦

ã“ã®ãƒ„ãƒ¼ãƒ«ã¯TypeScriptã§ä½œæˆã•ã‚Œã¦ãŠã‚Šã€ã»ã¼åŠ›æŠ€ã§å‡¦ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚
ä¸‹è¨˜ã¯Rubyã®ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹å‡¦ç†ã«ã«ãªã£ã¦ã„ã¾ã™ã€‚

```typescript
export function generate(data: YamlFormat, nameSpace: string) {
  const constantMappings = data.constants.values.map((item) => {
    try {
      const { key: originalKey, value, type } = item;
      const key = changeCase.constantCase(originalKey);

      const parsedType = typeParser(type);
      const supportedType = firstIntersectionType(
        parsedType,
        supportedTypes
      ) as SupportedType;

      if (supportedType === 'string') {
        return `${key} = '${value}'`;
      }

      return `${key} = ${value}`;
    } catch (error) {
      throw new Error(
        `Error processing item ${JSON.stringify(item)}:\n ${error}`
      );
    }
  });

  const code = `module ${nameSpace}
  ${constantMappings.join('\n  ')}
end
`;
```

ã¾ãšå¼•æ•°ã§ãƒ‘ãƒ¼ã‚¹ã•ã‚ŒãŸYamlã‚’å—ã‘å–ã‚Šã¾ã™ã€‚

```typescript
export function generate(data: YamlFormat, nameSpace: string)
```

Yamlã‹ã‚‰ã‚­ãƒ¼ã¨ãƒãƒªãƒ¥ãƒ¼ã‚’å–ã‚Šå‡ºã—Rubyã®å¤‰æ•°å®šç¾©ã®æ–‡æ³•(ä¾‹:`bar = 'string'`)ã«åˆã‚ã›ã¦æ•´å½¢ã—ãªãŠã—ã¾ã™ã€‚

```typescript
      const { key: originalKey, value, type } = item;
      const key = changeCase.constantCase(originalKey);

      const parsedType = typeParser(type);
      const supportedType = firstIntersectionType(
        parsedType,
        supportedTypes
      ) as SupportedType;

      if (supportedType === 'string') {
        return `${key} = '${value}'`;
      }

      return `${key} = ${value}`;
```

æœ€å¾Œã«æ•´å½¢ã—çµ‚ã‚ã£ãŸã‚‚ã®ã‚’åå‰ç©ºé–“ã¨ `module`ã¨`end`ã§æŒŸã‚ã°Rubyã®ã‚³ãƒ¼ãƒ‰ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã™ã€‚

## çµ‚ã‚ã‚Šã«

ã™ã”ãä¾¿åˆ©ãªãƒ„ãƒ¼ãƒ«ã¨ã„ã†ã‚ã‘ã§ã¯ãªã„ã§ã™ãŒã›ã£ã‹ãä½œã£ãŸã®ã§ç´¹ä»‹ã—ã¦ã¿ã¾ã—ãŸã€‚
